apiVersion: apiextensions.crossplane.io/v1
kind: Composition
metadata:
  name: s3-bucket-orphan-test
spec:
  compositeTypeRef:
    apiVersion: aws.platform.upbound.io/v1alpha1
    kind: XS3Bucket
  mode: Pipeline
  pipeline:
  - step: create-buckets
    functionRef:
      name: function-patch-and-transform
    input:
      apiVersion: pt.fn.crossplane.io/v1beta1
      kind: Resources
      resources:
      - name: bucketshouldprocess1
        base:
          apiVersion: s3.aws.upbound.io/v1beta1
          kind: Bucket
          spec:
            bucket: test
            deletionPolicy: Orphan
            managementPolicies: ["*"]
            forProvider:
              region: us-west-2
      - name: bucketshouldprocess2
        base:
          apiVersion: s3.aws.upbound.io/v1beta1
          kind: Bucket
          spec:
            bucket: test
            deletionPolicy: Delete
            managementPolicies: ["Create", "Update", "Observe"]
            forProvider:
              region: us-west-2
      - name: bucketshouldnotprocess
        base:
          apiVersion: s3.aws.upbound.io/v1beta1
          kind: Bucket
          spec:
            bucket: test
            deletionPolicy: Delete
            managementPolicies: ["*"]
            forProvider:
              region: us-west-2
  - step: external-name-backup
    functionRef:
      name: function-external-name-backup-restore
#    credentials:
#      - name: aws-creds
#        source: Secret
#        secretRef:
#          namespace: crossplane-system
#          name: aws-account-creds
#          key: credentials
